var DAY_MAP={0:"SU",M:"MO",2:"TU",W:"WE",4:"TH",F:"FR",6:"SA"},MS_PER_DAY=86400000,MS_PER_10_WEEKS=70*MS_PER_DAY;function getText(a,b){const c=a.querySelector(`[aria-describedby="${b}"]`);if(!c)throw alert("The WebReg table does not follow the expected format!"),Error(`No element with label ${b} could be found!`);return c.textContent.trim()}function toDayInWeek(a,b){let c=new Date(a);for(;c.getUTCDay()!==b;)c=new Date(c-MS_PER_DAY);return c.toISOString().split("T")[0]}function daysToArray(a,b={asNums:!1}){return a=a.replace("Su","0"),a=a.replace("Tu","2"),a=a.replace("Th","4"),a=a.replace("Sa","6"),b.asNums?(a=a.replace("M","1"),a=a.replace("W","3"),a=a.replace("F","5"),a.split("").map(a=>parseInt(a))):a.split("").map(a=>DAY_MAP[a])}var table=document.getElementById("list-id-table");if(!table)throw alert("The WebReg table could not be found on this page!"),Error("No table with id #list-id-table could be found!");var tableRows=Array.from(table.querySelector("tbody").children);tableRows.shift();var courseRows={},currentCourse=[],prevCourseTitle="";tableRows.forEach((a,b)=>{const c=a.firstElementChild.textContent.trim();c&&(0!==b&&(courseRows[prevCourseTitle]=currentCourse,currentCourse=[]),prevCourseTitle=c),currentCourse.push(a)}),courseRows[prevCourseTitle]=currentCourse;var courseEvents={};for(const a in courseRows){const b={},c=courseRows[a];c.forEach(a=>{const c=getText(a,"list-id-table_FK_CDI_INSTR_TYPE"),d={};d.days=getText(a,"list-id-table_DAY_CODE"),d.time=getText(a,"list-id-table_coltime");const e=getText(a,"list-id-table_BLDG_CODE"),f=getText(a,"list-id-table_ROOM_CODE");d.location=`${e} ${f}`,b[c]=d}),courseEvents[a]=b}(function a(){if("undefined"==typeof saveAs||"undefined"==typeof ics)console.log("Waiting for ICS dependencies..."),setTimeout(a,250);else{var b=ics();for(const a in courseEvents){const c=courseEvents[a],d=c.FI.days.split(" ")[1];for(const e in c){const f=`${a} - ${e}`,{days:g,location:h,time:i}=c[e],j=daysToArray(g,{asNums:!0})[0],k="FI"==e?d:toDayInWeek(new Date(d)-MS_PER_10_WEEKS,j),[l,m]=i.split("-").map(a=>a.slice(0,-1)+" "+a.slice(-1)+"m"),n=`${k} ${l}`,o=`${k} ${m}`;if("FI"!=e){const a={};a.freq="WEEKLY",a.until=toDayInWeek(d,0),a.byday=daysToArray(g),b.addEvent(f,"",h,n,o,a)}else b.addEvent(f,"",h,n,o)}}b.download("Course Calendar")}})();